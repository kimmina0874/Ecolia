<!DOCTYPE html>
<html>
<head>
	<title>Ecolia Realistic World</title>
	<style>
		svg image:hover {
			opacity: 0.7;
			cursor: pointer;
		}
	</style>
</head>
<body>
	<h1>üó∫Ô∏è Ecolia Realistic World</h1>

	<!-- üîº Ïù¥Îèô Î≤ÑÌäº -->
	<div style="margin-bottom: 10px;">
		<button onclick="move('up')">‚¨ÜÔ∏è ÏúÑ</button>
		<button onclick="move('left')">‚¨ÖÔ∏è Ï¢å</button>
		<button onclick="move('right')">‚û°Ô∏è Ïö∞</button>
		<button onclick="move('down')">‚¨áÔ∏è ÏïÑÎûò</button>
	</div>

	<!-- SVG Îßµ -->
	<svg id="map" width="640" height="640"></svg>

	<script>
		const TILE_SIZE = 64;
		const VIEW_SIZE = 10;           // ÌïúÎ≤àÏóê Î≥¥Ïù¥Îäî ÌÉÄÏùº Ïàò (10x10)
		const MAX_BOUND = 200;          // ÏµúÎåÄ Î≥¥Ïó¨Ï§Ñ Îßµ Í≤ΩÍ≥Ñ (200x200)
		let originX = 0;
		let originY = 0;
		const svg = document.getElementById("map");

		function fetchAndRenderMap() {
			svg.innerHTML = ""; // Í∏∞Ï°¥ ÌÉÄÏùº ÏßÄÏö∞Í∏∞
			fetch(`/api/map?x=${originX}&y=${originY}&size=${VIEW_SIZE}`)
				.then(res => res.json())
				.then(data => {
					const tiles = data.tiles;
					tiles.forEach((row, y) => {
						row.forEach((tile, x) => {
							const image = document.createElementNS("http://www.w3.org/2000/svg", "image");
							image.setAttribute("x", x * TILE_SIZE);
							image.setAttribute("y", y * TILE_SIZE);
							image.setAttribute("width", TILE_SIZE);
							image.setAttribute("height", TILE_SIZE);
							image.setAttributeNS("http://www.w3.org/1999/xlink", "href", `/static/tiles/${tile}.svg`);
							svg.appendChild(image);
						});
					});
				});
		}

		function move(direction) {
			const delta = VIEW_SIZE; // Ïù¥Îèô Í∞ÑÍ≤©
			if (direction === "up") originY = Math.max(0, originY - delta);
			if (direction === "down") originY = Math.min(MAX_BOUND - VIEW_SIZE, originY + delta);
			if (direction === "left") originX = Math.max(0, originX - delta);
			if (direction === "right") originX = Math.min(MAX_BOUND - VIEW_SIZE, originX + delta);
			fetchAndRenderMap();
		}

		// Ï¥àÍ∏∞ Î°úÎî©
		fetchAndRenderMap();
	</script>
</body>
</html>
